import{d as L,l as c,a as b,A as a,t as S,p as l,w as n,B as M,E as P,ay as s,ch as x,cq as T,f as r,cj as j,cr as k,cs as h,cm as U,o as y,aG as q}from"./index-YnGpMTyO.js";const A={class:"login"},D={class:"card"},G={key:0},J={class:"input-container"},O={class:"input-container"},R={key:1},z={class:"input-container"},F={class:"input-container"},H={class:"input-container"},K={class:"input-container"},Q={class:"input-container"},W={class:"switch-container"},X={key:0},Y={key:1},Z=L({__name:"LoginView",setup($){const d=c(!0),m=c(""),V=c(""),g=c(""),f=c(""),_=c(""),p=c(""),w=c(""),C=()=>{d.value=!d.value,d.value?(g.value="",f.value="",_.value="",p.value="",w.value=""):(m.value="",V.value="")},E=()=>{if(!m.value||!V.value){s.warning("请输入用户名和密码");return}x.login(m.value,V.value).then(o=>{var t;if(console.log("【登录响应】",o),console.log("【res类型】",typeof o),console.log("【res.code】",o==null?void 0:o.code),console.log("【res.obj】",o==null?void 0:o.obj),!o||typeof o!="object"){s.error("登录响应数据格式错误");return}if(o.code!==200){const v=typeof o.obj=="string"?o.obj:o.message||"登录失败";s.error(v);return}if(!o.obj||!o.obj.token){s.error("登录响应数据缺少必要字段(token)"),console.error("【响应数据异常】",o.obj);return}const e=1,u=o.obj.companyName||"company",i=o.obj.token;try{localStorage.setItem("companyId",String(e)),localStorage.setItem("companyName",u),localStorage.setItem("username",m.value),localStorage.setItem("token",i),console.log("【localStorage已设置】"),console.log("  companyId:",localStorage.getItem("companyId")),console.log("  token:",((t=localStorage.getItem("token"))==null?void 0:t.substring(0,20))+"...");const v=localStorage.getItem("companyId"),I=localStorage.getItem("token");if(!v||!I){s.error("登录信息保存失败，请检查浏览器存储权限"),console.error("【localStorage保存失败】",{savedCompanyId:v,savedToken:I});return}s.success("登录成功"),console.log("【准备跳转到首页】"),setTimeout(()=>{console.log("【执行路由跳转】"),T.push("/").catch(B=>{console.error("【路由跳转错误】",B),window.location.href="/"})},300)}catch(v){console.error("【localStorage操作错误】",v),s.error("登录信息保存异常："+String(v))}}).catch(o=>{var u;console.error("【登录请求错误】",o);const e=(o==null?void 0:o.message)||((u=o==null?void 0:o.data)==null?void 0:u.message)||JSON.stringify(o);s.error("登录失败: "+e)})},N=()=>{if(!g.value){s.warning("请输入用户名");return}if(!f.value){s.warning("请输入邮箱");return}if(!_.value){s.warning("请输入电话号码");return}if(!p.value){s.warning("请输入密码");return}if(p.value!==w.value){s.warning("两次输入的密码不一致");return}const o={username:g.value,email:f.value,password:p.value,phone:_.value};x.register(o).then(e=>{if(console.log(e),e.code!==200){s.error(e.obj||"注册失败");return}s.success("注册成功，请登录"),setTimeout(()=>{d.value=!0,g.value="",f.value="",p.value="",w.value="",_.value=""},1e3)}).catch(e=>{s.error("注册失败："+e)})};return(o,e)=>{const u=P,i=M;return y(),b("div",A,[a("div",D,[a("h2",null,S(d.value?"库灵之眼系统":"用户注册"),1),d.value?(y(),b("div",G,[a("div",J,[e[7]||(e[7]=a("div",{class:"input-title"},"用户名/邮箱",-1)),l(i,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=t=>m.value=t),placeholder:"请输入您的用户名或邮箱",clearable:""},{prefix:n(()=>[l(u,null,{default:n(()=>[l(r(j))]),_:1})]),_:1},8,["modelValue"])]),a("div",O,[e[8]||(e[8]=a("div",{class:"input-title"},"密码",-1)),l(i,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=t=>V.value=t),"show-password":"",placeholder:"请输入密码",clearable:""},{prefix:n(()=>[l(u,null,{default:n(()=>[l(r(k))]),_:1})]),_:1},8,["modelValue"])]),a("div",{class:"confirm-button",onClick:E},[l(u,null,{default:n(()=>[l(r(h))]),_:1}),e[9]||(e[9]=a("span",{class:"confirm-text"},"登录",-1))])])):(y(),b("div",R,[a("div",z,[e[10]||(e[10]=a("div",{class:"input-title"},"用户名",-1)),l(i,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=t=>g.value=t),placeholder:"请输入用户名",clearable:""},{prefix:n(()=>[l(u,null,{default:n(()=>[l(r(j))]),_:1})]),_:1},8,["modelValue"])]),a("div",F,[e[11]||(e[11]=a("div",{class:"input-title"},"邮箱",-1)),l(i,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=t=>f.value=t),placeholder:"请输入邮箱",clearable:""},{prefix:n(()=>[l(u,null,{default:n(()=>[l(r(U))]),_:1})]),_:1},8,["modelValue"])]),a("div",H,[e[12]||(e[12]=a("div",{class:"input-title"},"手机号码",-1)),l(i,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=t=>_.value=t),placeholder:"请输入手机号码",clearable:""},{prefix:n(()=>[l(u,null,{default:n(()=>[l(r(U))]),_:1})]),_:1},8,["modelValue"])]),a("div",K,[e[13]||(e[13]=a("div",{class:"input-title"},"密码",-1)),l(i,{modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=t=>p.value=t),"show-password":"",placeholder:"请输入密码",clearable:""},{prefix:n(()=>[l(u,null,{default:n(()=>[l(r(k))]),_:1})]),_:1},8,["modelValue"])]),a("div",Q,[e[14]||(e[14]=a("div",{class:"input-title"},"确认密码",-1)),l(i,{modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=t=>w.value=t),"show-password":"",placeholder:"请再次输入密码",clearable:""},{prefix:n(()=>[l(u,null,{default:n(()=>[l(r(k))]),_:1})]),_:1},8,["modelValue"])]),a("div",{class:"confirm-button",onClick:N},[l(u,null,{default:n(()=>[l(r(h))]),_:1}),e[15]||(e[15]=a("span",{class:"confirm-text"},"注册",-1))])])),a("div",W,[d.value?(y(),b("span",X,"还没有账号？")):(y(),b("span",Y,"已有账号？")),a("span",{class:"link",onClick:C},S(d.value?"立即注册":"立即登录"),1)])])])}}}),oe=q(Z,[["__scopeId","data-v-5f47a940"]]);export{oe as default};
