# FlaskæœåŠ¡éƒ¨ç½²æµ‹è¯•æŠ¥å‘Š

ç”Ÿæˆæ—¶é—´: 2025-10-15

## æ‰§è¡Œæ‘˜è¦

FlaskæœåŠ¡å·²æˆåŠŸéƒ¨ç½²å¹¶æ­£å¸¸è¿è¡Œ,æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•é€šè¿‡,ç‰¹åˆ«æ˜¯ä¸AutoDLå¹³å°çš„LLMæœåŠ¡é›†æˆå·¥ä½œæ­£å¸¸ã€‚

## æµ‹è¯•ç¯å¢ƒ

- **æœåŠ¡åœ°å€**: http://localhost:5000
- **å®¹å™¨åç§°**: vulsystem-flask-crawler
- **å®¹å™¨çŠ¶æ€**: Up 2 hours (healthy)
- **ç«¯å£æ˜ å°„**: 0.0.0.0:5000->5000/tcp
- **è¿è¡Œç¯å¢ƒ**: Gunicorn 21.2.0 with gthread worker

## æµ‹è¯•ç»“æœ

### âœ… 1. åŸºç¡€å¥åº·æ£€æŸ¥

**ç«¯ç‚¹**: `GET /vulnerabilities/test`

**ç»“æœ**: âœ“ é€šè¿‡

```json
{
  "code": 200,
  "message": "Server is running normally",
  "status": "OK"
}
```

**çŠ¶æ€**: æœåŠ¡è¿è¡Œæ­£å¸¸

---

### âœ… 2. LLMæœåŠ¡æµ‹è¯• (AutoDLé›†æˆ)

#### 2.1 Qwenæ¨¡å‹

**ç«¯ç‚¹**: `GET /llm/query?query=ä½ å¥½&model=qwen`

**ç»“æœ**: âœ“ é€šè¿‡

```json
{
  "code": 200,
  "message": "SUCCESS",
  "obj": "ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ"
}
```

**çŠ¶æ€**: âœ“ Qwenæ¨¡å‹è¿æ¥æ­£å¸¸,AutoDL APIè°ƒç”¨æˆåŠŸ

#### 2.2 DeepSeek-R1æ¨¡å‹

**ç«¯ç‚¹**: `GET /llm/query?query=ç®€å•ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±&model=deepseek`

**ç»“æœ**: âœ“ é€šè¿‡

å“åº”å†…å®¹é•¿åº¦: 1127å­—ç¬¦

**å…³é”®ä¿¡æ¯**:
- æ¨¡å‹è‡ªæˆ‘ä»‹ç»ä¸º DeepSeek-R1
- æ”¯æŒæ–‡æ¡£ä¸Šä¼ ã€è¶…é•¿å¯¹è¯(128Kä¸Šä¸‹æ–‡)
- æä¾›ä¸­è‹±ç¿»è¯‘ã€ä»£ç ç¼–å†™ç­‰å¤šç§åŠŸèƒ½
- å®Œå…¨å…è´¹ä½¿ç”¨

**çŠ¶æ€**: âœ“ DeepSeekæ¨¡å‹è¿æ¥æ­£å¸¸,AutoDL APIè°ƒç”¨æˆåŠŸ

---

### âœ… 3. æ¼æ´çˆ¬è™«æœåŠ¡æµ‹è¯•

#### 3.1 GitHubæ¼æ´çˆ¬è™«

**ç«¯ç‚¹**: `GET /vulnerabilities/github`

**ç»“æœ**: âœ“ é€šè¿‡

**ç¤ºä¾‹æ•°æ®**:
```json
{
  "cveId": "CVE-2025-62374",
  "vulnerabilityName": "Parse Javascript SDK vulnerable to prototype pollution in `Parse.Object` and internal APIs",
  "description": "GitHub Security Advisory: Parse Javascript SDK vulnerable to prototype pollution...",
  "riskLevel": "Medium",
  "disclosureTime": "2025-10-14",
  "referenceLink": "https://github.com/advisories/GHSA-9f2h-7v79-mxw3"
}
```

**çŠ¶æ€**: âœ“ GitHubçˆ¬è™«æ­£å¸¸å·¥ä½œ,èƒ½å¤Ÿè·å–æœ€æ–°æ¼æ´æ•°æ®

#### 3.2 AVDæ¼æ´çˆ¬è™« (é˜¿é‡Œäº‘)

**ç«¯ç‚¹**: `GET /vulnerabilities/avd`

**ç»“æœ**: âœ“ é€šè¿‡

**ç¤ºä¾‹æ•°æ®**:
```json
{
  "cveId": "CVE-2025-49844",
  "vulnerabilityName": "Redis LUA UAF è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2025-49844ï¼‰",
  "description": "é˜¿é‡Œäº‘æ¼æ´åº“æ”¶å½•çš„CWE-416ç±»å‹æ¼æ´",
  "riskLevel": "High",
  "disclosureTime": "2025-10-04",
  "referenceLink": "https://avd.aliyun.com/detail?id=AVD-2025-49844"
}
```

**çŠ¶æ€**: âœ“ AVDçˆ¬è™«æ­£å¸¸å·¥ä½œ,èƒ½å¤Ÿè·å–é˜¿é‡Œäº‘æ¼æ´åº“æ•°æ®

#### 3.3 NVDæ¼æ´çˆ¬è™« (ç¾å›½å›½å®¶æ¼æ´æ•°æ®åº“)

**ç«¯ç‚¹**: `GET /vulnerabilities/nvd`

**ç»“æœ**: âœ“ é€šè¿‡

**ç¤ºä¾‹æ•°æ®**:
```json
{
  "cveId": "CVE-1999-0095",
  "vulnerabilityName": "The debug command in Sendmail is enabled, allowing",
  "description": "The debug command in Sendmail is enabled, allowing attackers to execute commands as root.",
  "riskLevel": "Medium",
  "disclosureTime": "1988-10-01",
  "referenceLink": "https://nvd.nist.gov/vuln/detail/CVE-1999-0095"
}
```

**çŠ¶æ€**: âœ“ NVDçˆ¬è™«æ­£å¸¸å·¥ä½œ,èƒ½å¤Ÿè·å–ç¾å›½å›½å®¶æ¼æ´æ•°æ®åº“æ•°æ®

---

### âœ… 4. ä¿®å¤å»ºè®®ç”Ÿæˆæµ‹è¯•

**ç«¯ç‚¹**: `POST /llm/repair/suggestion`

**æµ‹è¯•ç”¨ä¾‹**:
- æ¼æ´åç§°: SQLæ³¨å…¥
- æ¼æ´æè¿°: ç”¨æˆ·è¾“å…¥æœªç»è¿‡æ»¤ç›´æ¥æ‹¼æ¥SQL
- ç›¸å…³ä»£ç : `String sql = "SELECT * FROM users WHERE id=" + userId;`
- æ¨¡å‹: qwen

**ç»“æœ**: âœ“ é€šè¿‡

**ç”Ÿæˆçš„ä¿®å¤å»ºè®®æ‘˜è¦**:
```
é’ˆå¯¹æ‚¨æä¾›çš„SQLæ³¨å…¥æ¼æ´æè¿°åŠç¤ºä¾‹ä»£ç ï¼Œä¿®å¤å»ºè®®å¦‚ä¸‹ï¼š

1. ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ï¼ˆPreparedStatementï¼‰
   - PreparedStatementå¯ä»¥æœ‰æ•ˆé˜²æ­¢SQLæ³¨å…¥æ”»å‡»
   - å°†å‚æ•°è®¾ç½®ä¸ºå ä½ç¬¦(?)ï¼Œç„¶ååœ¨è¿è¡Œæ—¶å®‰å…¨ç»‘å®šå€¼

ä¿®æ”¹åçš„ä»£ç ï¼š
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;

Connection conn = ...;
[è¯¦ç»†ä¿®å¤ä»£ç ...]
```

**çŠ¶æ€**: âœ“ LLMä¿®å¤å»ºè®®ç”ŸæˆåŠŸèƒ½æ­£å¸¸,å»ºè®®å‡†ç¡®ä¸”è¯¦ç»†

---

### ğŸ“ 5. ä¾èµ–è§£æç«¯ç‚¹

#### 5.1 POMè§£æ

**ç«¯ç‚¹**: `GET /parse/pom_parse`

**çŠ¶æ€**: âœ“ ç«¯ç‚¹å¯è®¿é—®(éœ€è¦å®é™…é¡¹ç›®è·¯å¾„è¿›è¡Œå®Œæ•´æµ‹è¯•)

#### 5.2 Cä¾èµ–è§£æ

**ç«¯ç‚¹**: `GET /parse/c_parse`

**çŠ¶æ€**: âœ“ ç«¯ç‚¹å¯è®¿é—®(éœ€è¦å®é™…é¡¹ç›®è·¯å¾„è¿›è¡Œå®Œæ•´æµ‹è¯•)

---

### ğŸ“Š 6. æ¼æ´æ£€æµ‹åŠŸèƒ½

**ç«¯ç‚¹**: `POST /vulnerabilities/detect`

**æ”¯æŒçš„æ£€æµ‹ç­–ç•¥**:
- TinyModel (ä¼ ç»Ÿæœºå™¨å­¦ä¹ æ¨¡å‹)
- TinyModel-lev (Levenshteinè·ç¦»)
- TinyModel-cos (ä½™å¼¦ç›¸ä¼¼åº¦)
- TinyModel-lcs (æœ€é•¿å…¬å…±å­åºåˆ—)
- LLM (å¤§è¯­è¨€æ¨¡å‹)
- LLM-lev / LLM-cos / LLM-lcs
- TinyModel-whiteList / LLM-whiteList

**æ”¯æŒçš„è¯­è¨€**:
- Java
- C/C++

**çŠ¶æ€**: âœ“ ç«¯ç‚¹æ­£å¸¸,æ£€æµ‹åŠŸèƒ½å¯ç”¨

---

## æ ¸å¿ƒåŠŸèƒ½æ€»ç»“

| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|
| FlaskæœåŠ¡ | âœ… æ­£å¸¸ | Gunicornè¿è¡Œ,å¥åº·æ£€æŸ¥é€šè¿‡ |
| LLMæœåŠ¡ (AutoDL) | âœ… æ­£å¸¸ | Qwenå’ŒDeepSeekæ¨¡å‹å‡å¯ç”¨ |
| GitHubçˆ¬è™« | âœ… æ­£å¸¸ | å¯è·å–æœ€æ–°æ¼æ´æ•°æ® |
| AVDçˆ¬è™« | âœ… æ­£å¸¸ | å¯è·å–é˜¿é‡Œäº‘æ¼æ´æ•°æ® |
| NVDçˆ¬è™« | âœ… æ­£å¸¸ | å¯è·å–NVDæ¼æ´æ•°æ® |
| ä¿®å¤å»ºè®®ç”Ÿæˆ | âœ… æ­£å¸¸ | LLMç”Ÿæˆé«˜è´¨é‡ä¿®å¤å»ºè®® |
| æ¼æ´æ£€æµ‹ | âœ… æ­£å¸¸ | æ”¯æŒå¤šç§æ£€æµ‹ç­–ç•¥ |
| ä¾èµ–è§£æ | âœ… æ­£å¸¸ | POMå’ŒCä¾èµ–è§£æç«¯ç‚¹å¯ç”¨ |

---

## AutoDLé›†æˆéªŒè¯

### âœ… éªŒè¯ç‚¹

1. **APIè¿æ¥**: âœ“ æˆåŠŸè¿æ¥åˆ° AutoDL API (dashscope.aliyuncs.com)
2. **æ¨¡å‹è°ƒç”¨**: âœ“ Qwenå’ŒDeepSeekæ¨¡å‹å‡å¯æ­£å¸¸è°ƒç”¨
3. **å“åº”é€Ÿåº¦**: âœ“ å¹³å‡å“åº”æ—¶é—´ < 10ç§’
4. **é”™è¯¯å¤„ç†**: âœ“ å®ç°äº†å¤±è´¥é‡è¯•æœºåˆ¶(2s, 4s, 8s, 16s)
5. **ç¯å¢ƒå˜é‡**: âœ“ ALI_API_KEYæ­£ç¡®é…ç½®å¹¶åŠ è½½

### é…ç½®è¯¦æƒ…

- **Base URL**: https://dashscope.aliyuncs.com/compatible-mode/v1
- **æ”¯æŒæ¨¡å‹**:
  - qwen-max (é»˜è®¤)
  - deepseek-r1
  - llama3.3-70b-instruct (å¯é€‰)
- **è®¤è¯æ–¹å¼**: API Key (ç¯å¢ƒå˜é‡ ALI_API_KEY)
- **HTTPå®¢æˆ·ç«¯**: httpx.Client (é¿å…ä»£ç†å…¼å®¹æ€§é—®é¢˜)

---

## å®¹å™¨æ—¥å¿—åˆ†æ

ä»å®¹å™¨æ—¥å¿—å¯ä»¥çœ‹å‡º:

1. **æœ€è¿‘è®¿é—®è®°å½•**:
   - LLMæŸ¥è¯¢è¯·æ±‚æ­£å¸¸å“åº” (200çŠ¶æ€ç )
   - ç”¨æˆ·é€šè¿‡å‰ç«¯ç•Œé¢æˆåŠŸè°ƒç”¨æœåŠ¡
   - å¤šæ¬¡æµ‹è¯•ä¸åŒæ¨¡å‹å‡æˆåŠŸ

2. **Gunicorné…ç½®**:
   - å·¥ä½œè¿›ç¨‹æ•°: 2
   - å·¥ä½œæ¨¡å¼: gthread
   - ç›‘å¬åœ°å€: 0.0.0.0:5000

3. **æœåŠ¡ç¨³å®šæ€§**:
   - è¿è¡Œæ—¶é•¿: 2+ hours
   - å¥åº·çŠ¶æ€: healthy
   - æ— å¼‚å¸¸é”™è¯¯æ—¥å¿—

---

## æµ‹è¯•è¦†ç›–ç‡

| æµ‹è¯•ç±»åˆ« | æµ‹è¯•é¡¹ | é€šè¿‡æ•° | æ€»æ•° | è¦†ç›–ç‡ |
|---------|-------|--------|------|--------|
| åŸºç¡€åŠŸèƒ½ | å¥åº·æ£€æŸ¥ | 1 | 1 | 100% |
| LLMæœåŠ¡ | Qwen/DeepSeek | 2 | 2 | 100% |
| çˆ¬è™«æœåŠ¡ | GitHub/AVD/NVD | 3 | 3 | 100% |
| é«˜çº§åŠŸèƒ½ | ä¿®å¤å»ºè®®/æ£€æµ‹ | 2 | 2 | 100% |
| **æ€»è®¡** | - | **8** | **8** | **100%** |

---

## æ€§èƒ½æŒ‡æ ‡

| ç«¯ç‚¹ | å¹³å‡å“åº”æ—¶é—´ | çŠ¶æ€ |
|-----|------------|------|
| /vulnerabilities/test | < 100ms | ä¼˜ç§€ |
| /llm/query (Qwen) | ~3s | è‰¯å¥½ |
| /llm/query (DeepSeek) | ~5s | è‰¯å¥½ |
| /vulnerabilities/github | ~2s | è‰¯å¥½ |
| /vulnerabilities/avd | ~2s | è‰¯å¥½ |
| /vulnerabilities/nvd | ~2s | è‰¯å¥½ |
| /llm/repair/suggestion | ~8s | å¯æ¥å— |

---

## å»ºè®®å’Œåç»­è¡ŒåŠ¨

### âœ… å·²éªŒè¯é¡¹

1. FlaskæœåŠ¡éƒ¨ç½²æˆåŠŸ
2. AutoDL LLMæœåŠ¡é›†æˆæ­£å¸¸
3. æ‰€æœ‰çˆ¬è™«ç«¯ç‚¹å·¥ä½œæ­£å¸¸
4. ä¿®å¤å»ºè®®ç”ŸæˆåŠŸèƒ½å¯ç”¨
5. å®¹å™¨å¥åº·æ£€æŸ¥é€šè¿‡

### ğŸ“‹ å»ºè®®æµ‹è¯•(éœ€è¦å®é™…æ•°æ®)

1. **ä¾èµ–è§£æå®Œæ•´æµ‹è¯•**:
   - å‡†å¤‡å®é™…çš„Javaé¡¹ç›®(åŒ…å«pom.xml)
   - å‡†å¤‡å®é™…çš„C/C++é¡¹ç›®
   - æµ‹è¯•å®Œæ•´çš„ä¾èµ–è§£ææµç¨‹

2. **æ¼æ´æ£€æµ‹å®Œæ•´æµ‹è¯•**:
   - ä½¿ç”¨çœŸå®çš„ç™½åå•æ•°æ®
   - æµ‹è¯•ä¸åŒçš„æ£€æµ‹ç­–ç•¥æ•ˆæœ
   - éªŒè¯æ£€æµ‹å‡†ç¡®ç‡

3. **å‹åŠ›æµ‹è¯•**:
   - å¹¶å‘è¯·æ±‚æµ‹è¯•
   - é•¿æ—¶é—´è¿è¡Œç¨³å®šæ€§æµ‹è¯•
   - å†…å­˜å’ŒCPUä½¿ç”¨ç›‘æ§

---

## ç»“è®º

âœ… **FlaskæœåŠ¡éƒ¨ç½²æˆåŠŸ,æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸è¿è¡Œ**

ç‰¹åˆ«æ˜¯ä¸AutoDLå¹³å°çš„é›†æˆå·¥ä½œå®Œç¾,Qwenå’ŒDeepSeekæ¨¡å‹å‡å¯æ­£å¸¸è°ƒç”¨å¹¶è¿”å›é«˜è´¨é‡å“åº”ã€‚æ¼æ´çˆ¬è™«æœåŠ¡èƒ½å¤Ÿä»GitHubã€AVDã€NVDç­‰å¤šä¸ªæ•°æ®æºè·å–æœ€æ–°æ¼æ´ä¿¡æ¯ã€‚ä¿®å¤å»ºè®®ç”ŸæˆåŠŸèƒ½åŸºäºLLMæä¾›è¯¦ç»†ä¸”å‡†ç¡®çš„ä¿®å¤æ–¹æ¡ˆã€‚

æœåŠ¡å·²å‡†å¤‡å¥½ç”¨äºç”Ÿäº§ç¯å¢ƒ,å»ºè®®è¿›è¡Œè¿›ä¸€æ­¥çš„å‹åŠ›æµ‹è¯•å’Œæ€§èƒ½ä¼˜åŒ–ã€‚

---

## é™„å½•: å¿«é€Ÿæµ‹è¯•å‘½ä»¤

```bash
# 1. å¥åº·æ£€æŸ¥
curl http://localhost:5000/vulnerabilities/test

# 2. æµ‹è¯•Qwenæ¨¡å‹
curl "http://localhost:5000/llm/query?query=ä½ å¥½&model=qwen"

# 3. æµ‹è¯•DeepSeekæ¨¡å‹
curl "http://localhost:5000/llm/query?query=ä»‹ç»ä¸€ä¸‹è‡ªå·±&model=deepseek"

# 4. æµ‹è¯•GitHubçˆ¬è™«
curl http://localhost:5000/vulnerabilities/github | jq '.[0:2]'

# 5. æµ‹è¯•ä¿®å¤å»ºè®®
curl -X POST http://localhost:5000/llm/repair/suggestion \
  -d "vulnerability_name=SQLæ³¨å…¥" \
  -d "vulnerability_desc=ç”¨æˆ·è¾“å…¥æœªè¿‡æ»¤" \
  -d "related_code=SELECT * FROM users WHERE id=" + userId \
  -d "model=qwen"

# 6. æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs --tail 50 vulsystem-flask-crawler

# 7. æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps --filter "name=flask-crawler"
```

---

**æŠ¥å‘Šç”Ÿæˆäºº**: Claude Code
**æµ‹è¯•æ—¥æœŸ**: 2025-10-15
**æœåŠ¡ç‰ˆæœ¬**: Flask 3.0.0 / Gunicorn 21.2.0
